ECSMemoryUtilization:
  AlarmActions:
    - Ref: StepScalingPolicy
  OKActions:
    - Ref: StepScalingPolicy
  ComparisonOperator: GreaterThanOrEqualToThreshold
  EvaluationPeriods: 1
  Threshold: 20
  Metrics:
    - Id: m1
      MetricStat:
        Metric:
          Namespace: AWS/ECS
          MetricName: MemoryUtilization
          Dimensions:
            - Name: ClusterName
              Value:
                Ref: CumulusECSCluster
        Period: 60
        Stat: Average
ActivitiesWaiting:
  AlarmActions:
    - Ref: StepECSServiceApplicationScalingPolicy
  OKActions:
    - Ref: StepECSServiceApplicationScalingPolicy
  TreatMissingData: notBreaching
  ComparisonOperator: GreaterThanOrEqualToThreshold
  EvaluationPeriods: 1
  Threshold: 0
  Metrics:
    - Id: e1
      Expression: m2 - m1
      Label: HelloWorldActivitiesWaiting
    - Id: m2
      MetricStat:
        Metric:
          Namespace: AWS/States
          MetricName: ActivitiesScheduled
          Dimensions:
            - Name: ActivityArn
              Value:
                Ref: HelloWorldActivity
        Period: 60
        Stat: Sum
        Unit: Count
      ReturnData: false
    - Id: m1
      MetricStat:
        Metric:
          Namespace: AWS/States
          MetricName: ActivitiesStarted
          Dimensions:
            - Name: ActivityArn
              Value:
                Ref: HelloWorldActivity
        Period: 60
        Stat: Sum
        Unit: Count
      ReturnData: false
