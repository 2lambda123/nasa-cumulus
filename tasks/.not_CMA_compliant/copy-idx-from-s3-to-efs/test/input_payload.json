{
  "workflow_config_template": {
    "arns_to_name_mappings": [
      {
        "name": "DiscoverCmrGranules",
        "arn": "arn:aws:lambda:us-east-1:000000000000:function:gitc-pgc-efs-task-discover-cmr-granules"
      },
      {
        "name": "SyncHttpUrls",
        "arn": "arn:aws:lambda:us-east-1:000000000000:function:gitc-pgc-efs-task-sync-http-urls"
      },
      {
        "name": "GenerateMrfFromTiff",
        "arn": "arn:aws:lambda:us-east-1:000000000000:function:gitc-pgc-efs-task-run-gdal"
      },
      {
        "name": "CopyIdxFromS3",
        "arn": "arn:aws:lambda:us-east-1:000000000000:function:gitc-pgc-efs-task-copy-idx-from-s3-to-efs"
      }
    ],
    "DiscoverCmrGranules": {
      "root": "https://cmr.earthdata.nasa.gov",
      "urls": "{meta.url_pattern}",
      "ingest_tracking_table": "gitc-pgc-efs-ingest-tracking",
      "event": "wms-map-found",
      "query": {
        "page_size": 25,
        "collection_concept_id": "C1000000320-LPDAAC_ECS",
        "day_night_flag": "{meta.day_night_flag}",
        "browse_only": true,
        "temporal": "2016-12-01T00:00:00Z,2016-12-01T01:18:30Z"
      },
      "granule_meta": {
        "key": "{meta.collection}/{granule.id}",
        "granuleId": "{granule.id}",
        "version": "{granule.updated}",
        "date": {
          "type": "date",
          "value": "{granule.time_start}"
        }
      }
    },
    "TriggerIngest": {
      "workflow": "arn:aws:states:us-east-1:000000000000:stateMachine:GitcPgcEfsIngestASTER-sWcNKE9iiLX5",
      "sqsQueueUrl": "https://sqs.us-east-1.amazonaws.com/000000000000/gitc-pgc-efs-ingest-AsterL1TIngestThrottlingQueue-1T2GMQAIQ7CMM"
    },
    "TriggerProcessing": {
      "key": "{meta.key}",
      "workflow": "arn:aws:states:us-east-1:000000000000:stateMachine:GitcPgcEfsProcessASTER-ZCaAPjQUqHYa",
      "sqsQueueUrl": "https://sqs.us-east-1.amazonaws.com/000000000000/gitc-pgc-efs-ingest-AsterL1TProcessThrottlingQueue-NJ3DSGT4K03O"
    },
    "SyncHttpUrls": {
      "stateless": true,
      "connections": 1,
      "auth": {
        "username": "gitc",
        "password": "TEhNOwiLwzgTEke3dfsmbi"
      },
      "output": {
        "bucket": "{resources.buckets.private}",
        "key_prefix": "sources/EPSG4326/AST_L1T/"
      }
    },
    "CopyIdxFromS3": {
      "dirname": "/var/www/html/EPSG{meta.epsg}/{meta.date.year}"
    },
    "DeleteIngestTrackingData": {
      "ingest_tracking_table": "gitc-pgc-efs-ingest-tracking",
      "granule_meta": {
        "granuleId": "{meta.granuleId}",
        "version": "{meta.version}"
      }
    },
    "GenerateMrfFromTiff": {
      "additional_files": [
        {
          "Bucket": "{resources.buckets.config}",
          "Key": "ingest/empty_tiles/Blank_RGBA_512.png"
        },
        {
          "Bucket": "{resources.buckets.config}",
          "Key": "ingest/mrfconfig/ast_l1t.xml"
        }
      ],
      "input_filenames": [
        "input.tif",
        "Blank_RGBA_512.png",
        "mrfgen_configuration_file.xml"
      ],
      "commands": [
        {
          "gdal_command": "gdalwarp",
          "args": [
            "-q",
            "-of",
            "VRT",
            "-t_srs",
            "EPSG:4326",
            "-srcnodata",
            "0 0 0",
            "-dstalpha",
            "-r",
            "average",
            "-overwrite",
            "input.tif",
            "input.vrt"
          ]
        },
        {
          "gdal_command": "gdal_translate",
          "args": [
            "-q",
            "-of",
            "PNG",
            "-co",
            "WORLDFILE=YES",
            "input.vrt",
            "in/processed.png"
          ]
        },
        {
          "gdal_command": "mrfgen.py",
          "args": []
        }
      ],
      "outputs": [
        {
          "filename": "out/out.mrf",
          "dest": {
            "Bucket": "{resources.buckets.public}",
            "Key": "archive/geographic/aster_l1t/mrfs/AST_L1T_LL/AST_L1T_LL{meta.date.dateTimeStamp}_.mrf"
          }
        },
        {
          "filename": "out/out.idx",
          "compress": true,
          "dest": {
            "Bucket": "{resources.buckets.public}",
            "Key": "archive/geographic/aster_l1t/mrfs/AST_L1T_LL/AST_L1T_LL{meta.date.dateTimeStamp}_.idx.tgz"
          }
        },
        {
          "filename": "out/out.ppg",
          "dest": {
            "Bucket": "{resources.buckets.public}",
            "Key": "archive/geographic/aster_l1t/mrfs/AST_L1T_LL/AST_L1T_LL{meta.date.dateTimeStamp}_.ppg"
          }
        }
      ]
    }
  },
  "resources": {
    "stack": "gitc-pgc-efs-ingest",
    "state_machine_prefix": "GitcPgcEfs",
    "buckets": {
      "config": "gitc-pgc-efs-deploy",
      "private": "gitc-pgc-efs-private",
      "public": "gitc-pgc-efs-public"
    },
    "tables": {
      "connections": "gitc-pgc-efs-connects",
      "locks": "gitc-pgc-efs-locks"
    }
  },
  "provider": {
    "id": "LPDAAC_DATAPOOL",
    "config": {
      "gateway_config": {
        "activity": "LPDAACDownloadActivity",
        "sync_activity": "LPDAACSyncActivity",
        "conn_config": {
          "conn_type": "http"
        },
        "num_connections": 20
      }
    }
  },
  "ingest_meta": {
    "message_source": "sfn",
    "start_date": "2018-01-31T17:58:16.667Z",
    "state_machine": "arn:aws:states:us-east-1:000000000000:stateMachine:GitcPgcEfsProcessASTER-ZCaAPjQUqHYa",
    "execution_name": "AST_L1T_LL__G1350986449-LPDAAC_ECS__3bb29cfc-bb78-4267-a193-d71c4f5864fb",
    "id": "3bb29cfc-bb78-4267-a193-d71c4f5864fb"
  },
  "meta": {
    "collection": "AST_L1T_LL",
    "day_night_flag": "day",
    "url_pattern": "_V.tif$",
    "key": "AST_L1T_LL/G1350986449-LPDAAC_ECS",
    "granuleId": "G1350986449-LPDAAC_ECS",
    "version": "2016-12-02T10:26:34.676Z",
    "date": {
      "isoDate": "2016-12-01",
      "isoDateTime": "2016-12-01T01:18:26.000Z",
      "dateTimeStamp": "20161201011826",
      "day": "01",
      "month": "12",
      "year": "2016"
    }
  },
  "exception": "None",
  "payload": [
    {
      "Key": "archive/geographic/aster_l1t/mrfs/AST_L1T_LL/AST_L1T_LL20161201011826_.mrf",
      "Bucket": "gitc-pgc-efs-public"
    },
    {
      "Key": "archive/geographic/aster_l1t/mrfs/AST_L1T_LL/AST_L1T_LL20161201011826_.idx.tgz",
      "Bucket": "gitc-pgc-efs-public"
    },
    {
      "Key": "archive/geographic/aster_l1t/mrfs/AST_L1T_LL/AST_L1T_LL20161201011826_.ppg",
      "Bucket": "gitc-pgc-efs-public"
    }
  ],
  "Bucket": "gitc-pgc-efs-private",
  "Key": "sources/EPSG4326/AST_L1T/AST_L1T_00312012016011826_20161202102359_20229_V.tif"
}