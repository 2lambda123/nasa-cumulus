---
id: logging-esdis-metrics
title: Writing logs for ESDIS Metrics
hide_title: true
---

# Writing logs for ESDIS Metrics

> **Note:** This feature is only available for Cumulus deployments in NGAP environments.
>
> **Prerequisite:** You must [configure your Cumulus deployment to deliver your logs to the correct shared logs destination for ESDIS metrics](../additional-deployment-options/cloudwatch-logs-delivery).

Log messages delivered to the ESDIS metrics destination conforming to an expected format will be automatically ingested and parsed to enable helpful searching/filtering of your logs via the ESDIS metrics Kibana dashboard.

## Expected log format

The ESDIS metrics pipeline expects a log message to be a JSON string representation of an object (`dict` in Python or `map` in Java) containing the following properties:

- `executions`: The AWS Step Function exection name in which this task is executing
- `granules`: A JSON string of the array of granule IDs being processed by this task
- `level`: A string identifier for the type of message being logged. Possible values:
  - `debug`
  - `error`
  - `fatal`
  - `info`
  - `warn`
  - `trace`
- `message`: String containing your actual log message
- `parentArn`: The parent AWS Step Function execution ARN that triggered the current execution, if any
- `sender`: The name of the resource executing this task (e.g. Lambda function name or ECS activity name)
- `stackName`: The unique prefix for your Cumulus deployment
- `timestamp`: An ISO-8601 formatted timestamp for the current time
- `version`: The version of the resource executing this task, if any

None of these properties are explicitly required, however omitting a `stackName` from your log would make it fairly useless in practice as it would be hard to search for in Kibana or to distinguish from logs generated by other deployments.

## Using Cumulus Message Adapter libraries

If your task is integrated with the Cumulus Message Adapter, then some of language specific client libraries can be used to write logs compatible with ESDIS metrics.

The usage of each library differs slightly, but in general they are initialized with a Cumulus workflow message to determine the contextual information (e.g. `granules` for the current workflow) and then subsequently writing logs only requires specifying a message.

- [cumulus-message-adapter-java](https://github.com/nasa/cumulus-message-adapter-java): [`AdapterLogger.java`](https://github.com/nasa/cumulus-message-adapter-java/blob/master/message_parser/src/main/java/cumulus_message_adapter/message_parser/AdapterLogger.java) class.
- [cumulus-message-adapter-python](https://github.com/nasa/cumulus-message-adapter-python): [`cumulus_logger.py`](https://github.com/nasa/cumulus-message-adapter-python/blob/master/cumulus_logger.py)

## Writing logs using custom code

Any code that produces logs matching the [expected log format](#expected-log-format) can be processed by ESDIS metrics.

### Node.js

For Node.js, Cumulus core provides a [`@cumulus/logger`](https://github.com/nasa/cumulus/tree/master/packages/logger) library to make writing logs compatible with ESDIS metrics easier.
